<?xml version="1.0" encoding="UTF-8"?>
<sv:node sv:name="ui-scroller" xmlns:sv="http://www.jcp.org/jcr/sv/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <sv:property sv:name="jcr:primaryType" sv:type="Name">
    <sv:value>mgnl:content</sv:value>
  </sv:property>
  <sv:property sv:name="jcr:mixinTypes" sv:type="Name">
    <sv:value>mix:lockable</sv:value>
  </sv:property>
  <sv:property sv:name="jcr:uuid" sv:type="String">
    <sv:value>5dde8e59-171d-44f5-af43-314b6fca5b9f</sv:value>
  </sv:property>
  <sv:property sv:name="bypass" sv:type="Boolean">
    <sv:value>false</sv:value>
  </sv:property>
  <sv:property sv:name="extension" sv:type="String">
    <sv:value>js</sv:value>
  </sv:property>
  <sv:property sv:name="jcr:created" sv:type="Date">
    <sv:value>2013-07-22T14:26:52.298+02:00</sv:value>
  </sv:property>
  <sv:property sv:name="rights" sv:type="String">
    <sv:value/>
  </sv:property>
  <sv:property sv:name="source" sv:type="String">
    <sv:value/>
  </sv:property>
  <sv:property sv:name="text" sv:type="String">
    <sv:value xsi:type="xs:base64Binary">LyoqDQogKiBAYXV0aG9yIGFsZXhhbmRlci5mYXJrYXMNCiAqLw0KKGZ1bmN0aW9uKCQpew0KICAkLndpZGdldCgndWkuc2Nyb2xsZXInLCB7DQogICAgb3B0aW9uczogew0KICAgICAgLy9XcmFwcGVyIENsYXNzZXM6DQogICAgICAgICAgaGlkaW5nV3JhcHBlcjogJ2Rpdi5yYWNrJywNCiAgICAgICAgICBtb3ZlV3JhcHBlcjogJ2Rpdi5yYWNrLWRlc2lnbicsDQogICAgICAgICAgLy9FbGVtZW50cyBDbGFzc2VzDQogICAgICAgICAgYXRvbXM6ICdkaXYudGVhc2VyJywNCiAgICAgICAgICBuZXh0TGluazogJ2EubmV4dCcsDQogICAgICAgICAgcHJldkxpbms6ICdhLnByZXYnLA0KICAgICAgICAgIGFjdGl2ZUxpbmtDbGFzczogJ3Nob3cnLA0KICAgICAgc3RpY2t5Rmlyc3RMYXN0OiB0cnVlLA0KICAgICAgDQogICAgICAgICAgbGlua0ZuOiAkLm5vb3AsDQogICAgICAgICAgbW92ZVN0ZXA6ICdhdG9tJywNCiAgICAgICAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJywNCiAgICAgIA0KICAgICAgICAgIGhpZGluZ1dpZHRoOiBmYWxzZSwNCiAgICAgICAgICBoaWRpbmdIZWlnaHQ6IGZhbHNlLA0KICAgICAgICAgIC8vYW5pbWF0ZQ0KICAgICAgICAgIGFuaW1hdGU6IHRydWUsDQogICAgICAgICAgYW5pbWF0ZU9wdGlvbnM6IHsNCiAgICAgICAgICAgICAgZHVyYXRpb246IDYwMCwNCiAgICAgICAgICAgICAgY29tcGxldGU6ICQubm9vcA0KICAgICAgICAgIH0sDQogICAgICAgICAgZW5hYmxlTXdoZWVsOiBmYWxzZSwvKiBzZXQgdG8gZmFsc2UgYnkgcmVpIDIwMTMwODA3ICovDQogICAgICANCiAgICAgICAgICBkaWFzaG93OiBmYWxzZSwNCiAgICAgIHJlc3RhcnREaWFTaG93OiB0cnVlLA0KICAgICAgDQogICAgICAgICAgYWRkU3ViUGl4ZWw6IDAsDQogICAgICByZWNhbGNTdGFnZU9ucmVzaXplOiB0cnVlLA0KICAgICAgdXBkYXRlT25JbWdMb2FkOiB0cnVlLA0KICAgICAgYmluZFN0eWxlOiAnYmluZCcsDQogICAgICANCiAgICAgICAgICBwYWdpbmF0aW9uOiBmYWxzZSwNCiAgICAgICAgICBwYWdpbmF0aW9uQXRvbXM6ICc8bGkgY2xhc3M9InBhLSRudW1iZXIiPjxhIGhyZWY9IiMiPiRudW1iZXI8L2E+PC9saT4nLA0KICAgICAgICAgIHBhZ2luYXRpb25UaXRsZUZyb206IGZhbHNlLA0KICAgICAgICAgIGFjdGl2ZVBhZ2luYXRpb25DbGFzczogJ29uJywNCiAgICAgICAgICBwYWdpbmF0aW9uRm46IGZhbHNlDQogICAgfSwNCiAgICBfY3JlYXRlOiBmdW5jdGlvbigpew0KICAgICAgDQogICAgICB2YXIgZWxlbSA9IHRoaXMuZWxlbWVudFswXSwNCiAgICAgICAgbyA9IHRoaXMub3B0aW9ucywNCiAgICAgICAgdGhhdCA9IHRoaXMsDQogICAgICAgIGZuICAgID0gby5hbmltYXRlT3B0aW9ucy5jb21wbGV0ZQ0KICAgICAgOw0KICAgICAgDQogICAgICAgICAgby5hbmltYXRlT3B0aW9ucy5jb21wbGV0ZSA9IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgIGlmKGZuICYmICQuaXNGdW5jdGlvbihmbikpew0KICAgICAgICAgIGZuLmNhbGwodGhpcywgdGhhdCk7DQogICAgICAgIH0NCiAgICAgICAgICAgICAgdGhhdC5wcm9wYWdhdGUoJ2VuZCcpOw0KICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICBvLmRpcmVjdGlvbiA9IChvLmRpcmVjdGlvbiA9PSAndmVydGljYWwnKSA/IHsNCiAgICAgICAgICAgICAgc2Nyb2xsOiAnc2Nyb2xsVG9wJywNCiAgICAgICAgICAgICAgb3V0ZXJEOiAnb3V0ZXJIZWlnaHQnLA0KICAgICAgICAgICAgICBkaW06ICdoZWlnaHQnLA0KICAgICAgICBkaXI6ICdUb3AnDQogICAgICAgICAgfSA6IHsNCiAgICAgICAgICAgICAgc2Nyb2xsOiAnc2Nyb2xsTGVmdCcsDQogICAgICAgICAgICAgIG91dGVyRDogJ291dGVyV2lkdGgnLA0KICAgICAgICAgICAgICBkaW06ICd3aWR0aCcsDQogICAgICAgIGRpcjogJ0xlZnQnDQogICAgICAgICAgfTsNCiAgICAgIA0KICAgICAgICAgIHRoaXMubW92ZUVsZW0gPSAkKG8ubW92ZVdyYXBwZXIsIGVsZW0pOw0KICAgICAgICAgIHRoaXMuYXRvbUVsZW0gPSAkKG8uYXRvbXMsIGVsZW0pOw0KICAgICAgICAgIHRoaXMuaGlkaW5nV3JhcHBlciA9ICQoby5oaWRpbmdXcmFwcGVyLCBlbGVtKTsNCiAgICAgICAgICANCiAgICAgICAgICB0aGlzLm5leHRMaW5rID0gJChvLm5leHRMaW5rLCBlbGVtKTsNCiAgICAgICAgICB0aGlzLnByZXZMaW5rID0gJChvLnByZXZMaW5rLCBlbGVtKTsNCiAgICAgICAgICANCiAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gMDsNCiAgICAgICAgICB0aGlzLmF0b21Qb3MgPSAwOw0KICAgICAgICAgIHRoaXMucGVyY2VudGFnZSA9IDA7DQogICAgICAgICAgdGhpcy5vbGRQb3NpdGlvbiA9IDA7DQogICAgICAgICAgdGhpcy5vbGRBdG9tUG9zID0gMDsNCiAgICAgICAgICBpZiAoby5oaWRpbmdIZWlnaHQgfHwgby5oaWRpbmdXaWR0aCkgew0KICAgICAgICAgICAgICB2YXIgY3NzID0gKG8uaGlkaW5nSGVpZ2h0KSA/IHsNCiAgICAgICAgICAgICAgICAgIGhlaWdodDogby5oaWRpbmdIZWlnaHQNCiAgICAgICAgICAgICAgfSA6IHt9Ow0KICAgICAgICAgICAgICBpZiAoKG8uaGlkaW5nV2lkdGgpKSB7DQogICAgICAgICAgICAgICAgICBjc3MgPSAkLmV4dGVuZChjc3MsIHsNCiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogby5oaWRpbmdXaWR0aA0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy5oaWRpbmdXcmFwcGVyLmNzcyhjc3MpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgdGhpcy5zZWxlY3RlZEZvY3VzID0gZmFsc2U7DQogICAgICANCiAgICAgIA0KICAgICAgaWYoJC5mbi5zZXRGb2N1cyAmJiAkLmZuLmNsb3Nlc3Qpew0KICAgICAgICB2YXIgdHJhdmVyc2UgPSB7fTsNCiAgICAgICAgaWYoKG8uZGlyZWN0aW9uLmRpciA9PT0gJ1RvcCcpKXsNCiAgICAgICAgICB0cmF2ZXJzZVskLnVpLmtleUNvZGUuVVBdID0gJ3ByZXYnOw0KICAgICAgICAgIHRyYXZlcnNlWyQudWkua2V5Q29kZS5ET1dOXSA9ICduZXh0JzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0cmF2ZXJzZVskLnVpLmtleUNvZGUuTEVGVF0gPSAncHJldic7DQogICAgICAgICAgdHJhdmVyc2VbJC51aS5rZXlDb2RlLlJJR0hUXSA9ICduZXh0JzsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm1vdmVFbGVtDQogICAgICAgICAgLmJpbmQoJ2tleWZvY3VzJywgZnVuY3Rpb24oZSl7DQogICAgICAgICAgICB2YXIgYXRvbSA9ICQoZS50YXJnZXQpLmNsb3Nlc3Qoby5hdG9tcyk7DQogICAgICAgICAgICBpZihhdG9tWzBdKXsNCiAgICAgICAgICAgICAgdGhhdC5zY3JvbGxJbnRvVmlldyhhdG9tKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5iaW5kKCdmb2N1c2luJywgZnVuY3Rpb24oZSl7DQogICAgICAgICAgICB2YXIgYXRvbSA9ICQoZS50YXJnZXQpLmNsb3Nlc3Qoby5hdG9tcyk7DQogICAgICAgICAgICB0aGF0LnNlbGVjdGVkRm9jdXMgPSAoYXRvbVswXSkgPyBhdG9tIDogZmFsc2U7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuYmluZCgnZm9jdXNvdXQnLCBmdW5jdGlvbihlKXsNCiAgICAgICAgICAgIHRoYXQuc2VsZWN0ZWRGb2N1cyA9IGZhbHNlOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmJpbmQoJ2tleWRvd24nLCBmdW5jdGlvbihlKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodGhhdC5zZWxlY3RlZEZvY3VzID09PSBmYWxzZSB8fCAhdHJhdmVyc2VbZS5rZXlDb2RlXSl7cmV0dXJuO30NCiAgICAgICAgICAgIHZhciBzZWxlY3RFbGVtZW50ID0gdGhhdC5zZWxlY3RlZEZvY3VzW3RyYXZlcnNlW2Uua2V5Q29kZV1dKG8uYXRvbXMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihzZWxlY3RFbGVtZW50ICYmIHNlbGVjdEVsZW1lbnRbMF0pew0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQuc2V0Rm9jdXMoKTsNCiAgICAgICAgICAgICAgdGhhdC5zY3JvbGxJbnRvVmlldyhzZWxlY3RFbGVtZW50KTsNCiAgICAgICAgICAgIH0gZWxzZSBpZih0aGF0LmlzU2xpZGluZyl7DQogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgDQogICAgICAgICAgdGhpcy5kaW1zID0gWzBdOw0KICAgICAgICAgIHRoaXMuaGlkaW5nV3JhcHBlcltvLmRpcmVjdGlvbi5zY3JvbGxdKDApOw0KICAgICAgdGhpcy5taW5Qb3MgPSAwOw0KICAgICAgICAgIHRoaXMudXBkYXRlKCk7DQogICAgICANCiAgICAgIGlmKG8ucmVjYWxjU3RhZ2VPbnJlc2l6ZSl7DQogICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbigpew0KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRoYXQuc3RhZ2VXaWR0aFVwZGF0ZS5jYWxsKHRoYXQpOw0KICAgICAgICAgIH0sIDApOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIA0KICAgICAgaWYoby51cGRhdGVPbkltZ0xvYWQpew0KICAgICAgICB0aGlzLnVwZGF0ZU9uSW1nTG9hZCgpOw0KICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKG8uZGlhc2hvdykgew0KICAgICAgICAgICAgICB0aGlzLnN0YXJ0RGlhc2hvdygpOw0KICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYmluZCgnbW91c2VlbnRlciBmb2N1c2luJywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhhdC5kaWFUaW1lcik7DQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGF0LmRpYVRpbWVyKTsNCiAgICAgICAgICB9LCA5KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgIGlmKG8ucmVzdGFydERpYVNob3cpew0KICAgICAgICAgIHRoaXMuZWxlbWVudA0KICAgICAgICAgICAgLmJpbmQoJ21vdXNlbGVhdmUgZm9jdXNvdXQnLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc3RhcnREaWFzaG93LmNhbGwodGhhdCk7DQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChvLmVuYWJsZU13aGVlbCAmJiAkLmZuLm13aGVlbEludGVudCkgew0KICAgICAgICB0aGlzLmhpZGluZ1dyYXBwZXIubXdoZWVsSW50ZW50KGZ1bmN0aW9uKGUsIGQpew0KICAgICAgICAgICAgICAgICAgdGhhdC5zdG9wRGlhc2hvdy5jYWxsKHRoYXQpOw0KICAgICAgICAgICAgICAgICAgZCA9IChkIDwgMCkgPyAnLScgOiAnKyc7DQogICAgICAgICAgaWYoKHRoYXQucG9zaXRpb24gPj0gdGhhdC5tYXhQb3MgJiYgZCA9PT0gJy0nKSB8fCAoZCA9PT0gJysnICYmIHRoYXQucG9zaXRpb24gPD0gdGhhdC5taW5Qb3MpKXsNCiAgICAgICAgICAgIHJldHVybiAhdGhhdC5pc1NsaWRpbmc7DQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgdmFyIG1vdmVTdGVwID0gKG8ubW92ZVN0ZXApID8gby5tb3ZlU3RlcCA6ICdhdG9tJzsNCiAgICAgICAgICAgICAgICAgIHRoYXQubW92ZVRvKGQgKyAnYXRvbTEnKTsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICB2YXIgaGFuZGxlUHJldk5leHQgPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgICB2YXIgZGlyID0gKCQuaW5BcnJheSh0aGlzLCB0aGF0LnByZXZMaW5rKSAhPT0gLTEpID8NCiAgICAgICAgICAnKycgOg0KICAgICAgICAgICctJzsNCiAgICAgICAgdGhhdC5zdG9wRGlhc2hvdy5jYWxsKHRoYXQpOw0KICAgICAgICAgICAgICB0aGF0Lm1vdmVUbyhkaXIgKyBvLm1vdmVTdGVwKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICB0aGlzLm5leHRMaW5rDQogICAgICAgIC5iaW5kKCdjbGljay51aXNjcm9sbGVyJywgaGFuZGxlUHJldk5leHQpOw0KICAgICAgICAgIHRoaXMucHJldkxpbmsNCiAgICAgICAgLmJpbmQoJ2NsaWNrLnVpc2Nyb2xsZXInLCBoYW5kbGVQcmV2TmV4dCk7DQogICAgICBpZigkLmJyb3dzZXIubXNpZSAmJiBwYXJzZUludCgkLmJyb3dzZXIudmVyc2lvbiwgMTApIDwgNyl7DQogICAgICAgIHZhciBvdmVyID0gZnVuY3Rpb24oKXskKHRoaXMpLmFkZENsYXNzKCdvdmVyJyk7fSwNCiAgICAgICAgICBvdXQgPSBmdW5jdGlvbigpeyQodGhpcykucmVtb3ZlQ2xhc3MoJ292ZXInKTt9DQogICAgICAgIDsNCiAgICAgICAgdGhpcy5uZXh0TGluaw0KICAgICAgICAgIC5ob3ZlcihvdmVyLCBvdXQpOw0KICAgICAgICAgICAgdGhpcy5wcmV2TGluaw0KICAgICAgICAgIC5ob3ZlcihvdmVyLCBvdXQpOw0KICAgICAgfSAgDQogICAgICBpZihvLmRlZmF1bHRTZWxlY3RlZCl7DQogICAgICAgIHRoaXMubW92ZVRvKCdnb1RvJysgby5kZWZhdWx0U2VsZWN0ZWQsIGZhbHNlKTsNCiAgICAgIH0gICAgDQogICAgICB0aGlzLnByb3BhZ2F0ZSgnaW5pdCcpOw0KICAgIH0sDQogICAgc3RhZ2VXaWR0aFVwZGF0ZTogZnVuY3Rpb24oKXsNCiAgICAgIHRoaXMuZGltc1sxXSA9IHRoaXMuaGlkaW5nV3JhcHBlclt0aGlzLm9wdGlvbnMuZGlyZWN0aW9uLmRpbV0oKTsNCiAgICAgIHRoaXMubWF4UG9zID0gKHRoaXMuZGltc1swXSAtIHRoaXMuZGltc1sxXSk7DQogICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uX0NvbnRyb2xzKCk7DQogICAgfSwNCiAgICAgICAgY3JlYXRlUGFnaW5hdGlvbjogZnVuY3Rpb24oaGFyZCl7DQogICAgICAgICAgICB2YXIgY29udGVudCA9ICc8dWw+JywgdGhhdCA9IHRoaXMsIHRtcENvbnRlbnQsIG8gPSB0aGlzLm9wdGlvbnM7DQogICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24gPSAkKG8ucGFnaW5hdGlvbiwgdGhpcy5lbGVtZW50WzBdKTsNCiAgICAgICAgICAgIHRoaXMuYXRvbUVsZW0uZWFjaChmdW5jdGlvbihpKXsNCiAgICAgICAgICAgICAgICB0bXBDb250ZW50ID0gby5wYWdpbmF0aW9uQXRvbXMucmVwbGFjZSgvXCRudW1iZXIvZywgaSArIDEpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gKG8ucGFnaW5hdGlvblRpdGxlRnJvbSkgPyB0bXBDb250ZW50LnJlcGxhY2UoL1wkdGl0bGUvZywgJChvLnBhZ2luYXRpb25UaXRsZUZyb20sIHRoaXMpLnRleHQoKSkgOiB0bXBDb250ZW50Ow0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLnBhZ2luYXRpb24uaHRtbChjb250ZW50ICsgJzwvdWw+JykuZmluZCgnYScpLmVhY2goZnVuY3Rpb24oaSl7DQogICAgICAgICAgICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICB0aGF0LnN0b3BEaWFzaG93LmNhbGwodGhhdCk7DQogICAgICAgICAgICAgICAgICAgIHRoYXQubW92ZVRvLmNhbGwodGhhdCwgJ2dvVG8nICsgaSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KICAgIGdldEluZGV4TmVhclBvczogZnVuY3Rpb24oblBvcyl7DQogICAgICB2YXIgbGVuID0gdGhpcy5kaW1zLmxlbmd0aDsNCiAgICAgIHdoaWxlIChsZW4tLSkgew0KICAgICAgICAgICAgICAgIGlmIChuUG9zID49IHRoaXMuZGltc1tsZW5dKSB7ICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSwNCiAgICBpblZpZXc6IGZ1bmN0aW9uKGF0b20pew0KICAgICAgdmFyIGRpciAgICAgPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uLA0KICAgICAgICBzdGFnZURpbSAgID0gdGhpcy5kaW1zWzFdLA0KICAgICAgICBhdG9tRGltICAgPSBhdG9tW2Rpci5vdXRlckRdKCksDQogICAgICAgIGN1clBvcyAgICA9IHRoaXMuaGlkaW5nV3JhcHBlclsnc2Nyb2xsJyArIGRpci5kaXJdKCksDQogICAgICAgIGF0b21Qb3MgICA9IGF0b21bMF1bJ29mZnNldCcrIGRpci5kaXJdDQogICAgICA7DQogICAgICBpZihjdXJQb3MgPiBhdG9tUG9zIHx8IHN0YWdlRGltIDwgYXRvbURpbSArIGF0b21Qb3MgLSBjdXJQb3Mpew0KICAgICAgICByZXR1cm4gYXRvbVBvczsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICAgIHNjcm9sbEludG9WaWV3OiBmdW5jdGlvbihhdG9tKXsNCiAgICAgIHZhciBpblZpZXcgPSB0aGlzLmluVmlldyhhdG9tKTsNCiAgICAgIGlmKGluVmlldyAhPT0gZmFsc2Upew0KICAgICAgICB0aGlzLm1vdmVUbyhpblZpZXcpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oaywgdil7DQogICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7DQogICAgICAgICAgc3dpdGNoKGspIHsNCiAgICAgICAgICAgIGNhc2UgJ2VuYWJsZU13aGVlbCcgOg0KICAgICAgICAgICAgICBpZiggIXYgJiYgby5lbmFibGVNd2hlZWwpew0KICAgICAgICAgICAgICAgIHRoaXMuaGlkaW5nV3JhcHBlci51bm13aGVlbEludGVudCgpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICANCiAgICAgICAgICAgIGNhc2UgJ2FkZFN1YlBpeGVsJzoNCiAgICAgICAgICAgICAgaWYoby5hZGRTdWJQaXhlbCAhPT0gdikgew0KICAgICAgICAgICAgICAgIHRoaXMuZGltc1swXSAtPSBvLmFkZFN1YlBpeGVsOw0KICAgICAgICAgICAgICAgIG8uYWRkU3ViUGl4ZWwgPSB2Ow0KICAgICAgICAgICAgICAgIHRoaXMuZGltc1swXSArPSBvLmFkZFN1YlBpeGVsOw0KICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgICQuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgICAgIH0sDQogICAgICAgIHN0YXJ0RGlhc2hvdzogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5kaWFUaW1lcik7DQogICAgICAgICAgICB0aGlzLmRpYVRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAoKHRoYXQucG9zaXRpb24gPT09IHRoYXQubWF4UG9zICYmIHRoYXQub3B0aW9ucy50eXBlICE9PSAnY2Fyb3VzZWwnKSA/IHRoYXQubW92ZVRvKDAsIGZhbHNlKSA6IHRoYXQubW92ZVRvKCctJyArIHRoYXQub3B0aW9ucy5tb3ZlU3RlcCkpOw0KICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmRpYXNob3cpOw0KICAgICAgICB9LA0KICAgICAgICBzdG9wRGlhc2hvdzogZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHRoaXMuZWxlbWVudC51bmJpbmQoJy5kaWFzaG93Jyk7DQogICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuZGlhVGltZXIpOw0KICAgICAgICB9LA0KICAgIHVwZGF0ZU9uSW1nTG9hZDogZnVuY3Rpb24oKXsNCiAgICAgIHZhciBsb2FkaW5nU2l6ZSA9IDA7DQogICAgICB2YXIgdGhhdCA9IHRoaXM7DQogICAgICAkKCdpbWcnLCB0aGlzLmVsZW1lbnQpLmVhY2goZnVuY3Rpb24oKXsNCiAgICAgICAgaWYoIXRoaXMuY29tcGxldGUpew0KICAgICAgICAgIGxvYWRpbmdTaXplKys7DQogICAgICAgICAgJCh0aGlzKS5vbmUoJ2xvYWQnLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgbG9hZGluZ1NpemUtLTsNCiAgICAgICAgICAgIGlmKCFsb2FkaW5nU2l6ZSl7DQogICAgICAgICAgICAgIHRoYXQudXBkYXRlKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGhhcmQpew0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBqRWxtLCBvID0gdGhpcy5vcHRpb25zOw0KICAgICAgICAgICAgDQogICAgICBpZiAoaGFyZCkgew0KICAgICAgICAgICAgICAgIHRoaXMuZGltcyA9IFswXTsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgdGhpcy5kaW1zWzFdID0gdGhpcy5oaWRpbmdXcmFwcGVyLmNzcyh7DQogICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLA0KICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJw0KICAgICAgICAgICAgfSlbby5kaXJlY3Rpb24uZGltXSgpOw0KICAgICAgDQogICAgICAgICAgICB2YXIgZnJvbSA9IHRoaXMuZGltcy5sZW5ndGggLSAyOw0KICAgICAgZm9yKHZhciBpID0gZnJvbSwgbGVuID0gdGhpcy5hdG9tRWxlbS5sZW5ndGg7IGkgPCBsZW47IGkrKyl7DQogICAgICAgICAgICAgICAgakVsbSA9ICQodGhpcy5hdG9tRWxlbVtpXSk7DQogICAgICAgICAgICAgICAgdGhhdC5kaW1zLnB1c2godGhhdC5kaW1zWzBdKTsNCiAgICAgICAgICAgICAgICB0aGF0LmRpbXNbMF0gKz0gakVsbVtvLmRpcmVjdGlvbi5vdXRlckRdKHttYXJnaW46IHRydWV9KTsNCiAgICAgIH0NCiAgICAgIHRoaXMuZGltc1swXSArPSBvLmFkZFN1YlBpeGVsOw0KICAgICAgICAgICAgdGhpcy5tYXhQb3MgPSAodGhpcy5kaW1zWzBdIC0gdGhpcy5kaW1zWzFdKTsNCiAgICAgIA0KICAgICAgdmFyIG1vdmVDc3MgPSB7fTsNCiAgICAgIG1vdmVDc3Nbby5kaXJlY3Rpb24uZGltXSA9IHRoaXMuZGltc1swXSArICdweCc7DQogICAgICANCiAgICAgICAgICAgIHRoaXMubW92ZUVsZW0uY3NzKG1vdmVDc3MpOw0KICAgICAgDQogICAgICAgICAgICBpZiAoby5wYWdpbmF0aW9uKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVQYWdpbmF0aW9uKGhhcmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbl9Db250cm9scygpOw0KICAgICAgICB9LA0KICAgICAgICB1cGRhdGVQb3NpdGlvbl9Db250cm9sczogZnVuY3Rpb24ocG9zKXsNCiAgICAgIC8vY2FsY3VsYXRlIHRoZSBjdXJlbnQgcG9zaXRpb24NCiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zOw0KICAgICAgcG9zID0gKGlzTmFOKHBvcykpID8gcGFyc2VJbnQodGhpcy5oaWRpbmdXcmFwcGVyW28uZGlyZWN0aW9uLnNjcm9sbF0oKSwgMTApIDogcG9zOw0KICAgICAgDQogICAgICBmdW5jdGlvbiBjaGFuZ2VTdGF0ZShlbGVtLCBhY3RpdmUpew0KICAgICAgICB2YXIgZG9vID0gKGFjdGl2ZSkgP3sNCiAgICAgICAgICAgIHN0eWxlOiAnYWRkQ2xhc3MnDQogICAgICAgICAgfSA6IHsNCiAgICAgICAgICAgIHN0eWxlOiAncmVtb3ZlQ2xhc3MnDQogICAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIGVsZW1bZG9vLnN0eWxlXShvLmFjdGl2ZUxpbmtDbGFzcyk7DQogICAgICB9DQogICAgICANCiAgICAgICAgICAgIGlmKHBvcyAhPT0gdGhpcy5wb3NpdGlvbil7DQogICAgICAgIHRoaXMucGVyY2VudGFnZSA9IHBvcyAvICh0aGlzLm1heFBvcyAvIDEwMCk7DQogICAgICAgICAgICAgIHRoaXMub2xkUG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uOw0KICAgICAgICAgICAgICB0aGlzLm9sZEF0b21Qb3MgPSB0aGlzLmF0b21Qb3M7DQogICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3M7DQogICAgICAgIA0KICAgICAgICAgICAgICB2YXIgbnVtID0gdGhpcy5nZXRJbmRleE5lYXJQb3ModGhpcy5wb3NpdGlvbik7DQogICAgICAgICAgICAgDQogICAgICAgICAgbnVtID0gKG51bSkgPyBudW0gLSAyIDogMDsNCiAgICAgICAgICAgICAgdGhpcy5hdG9tUG9zID0gbnVtOw0KICAgICAgfQ0KICAgICAgDQogICAgICB0aGlzLnBlcmNlbnRhZ2UgPSBwb3MgLyAodGhpcy5tYXhQb3MgLyAxMDApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAocG9zIDw9IHRoaXMubWluUG9zICYmIHRoaXMucHJldkxpbmsuaGFzQ2xhc3Moby5hY3RpdmVMaW5rQ2xhc3MpKSB7DQogICAgICAgICAgICAgICAgby5saW5rRm4uY2FsbCh0aGlzLnByZXZMaW5rLCAnaGlkZScsIHRoaXMudWkoKSk7DQogICAgICAgIGNoYW5nZVN0YXRlKHRoaXMucHJldkxpbmspOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgICAgICBpZiAocG9zID4gdGhpcy5taW5Qb3MgJiYgIXRoaXMucHJldkxpbmsuaGFzQ2xhc3Moby5hY3RpdmVMaW5rQ2xhc3MpKSB7DQogICAgICAgICAgICAgICAgICAgIG8ubGlua0ZuLmNhbGwodGhpcy5wcmV2TGluaywgJ3Nob3cnLCB0aGlzLnVpKCkpOw0KICAgICAgICAgIGNoYW5nZVN0YXRlKHRoaXMucHJldkxpbmssIHRydWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwb3MgPj0gdGhpcy5tYXhQb3MgJiYgdGhpcy5uZXh0TGluay5oYXNDbGFzcyhvLmFjdGl2ZUxpbmtDbGFzcykpIHsNCiAgICAgICAgICAgICAgICBvLmxpbmtGbi5jYWxsKHRoaXMubmV4dExpbmssICdoaWRlJywgdGhpcy51aSgpKTsNCiAgICAgICAgY2hhbmdlU3RhdGUodGhpcy5uZXh0TGluayk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgICAgIGlmIChwb3MgPCB0aGlzLm1heFBvcyAmJiAhdGhpcy5uZXh0TGluay5oYXNDbGFzcyhvLmFjdGl2ZUxpbmtDbGFzcykpIHsNCiAgICAgICAgICAgICAgICAgICAgby5saW5rRm4uY2FsbCh0aGlzLm5leHRMaW5rLCAnc2hvdycsIHRoaXMudWkoKSk7DQogICAgICAgICAgY2hhbmdlU3RhdGUodGhpcy5uZXh0TGluaywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMucGFnaW5hdGlvbikgew0KICAgICAgICAgICAgICAgIHZhciBvbGRBY3RpdmUgPSB0aGlzLnBhZ2luYXRpb24uZmluZCgnbGknKS5maWx0ZXIoJy4nICsgby5hY3RpdmVQYWdpbmF0aW9uQ2xhc3MpLnJlbW92ZUNsYXNzKG8uYWN0aXZlUGFnaW5hdGlvbkNsYXNzKSwgbmV3QWN0aXZlID0gb2xkQWN0aXZlLmVuZCgpLmVxKHRoaXMuYXRvbVBvcykuYWRkQ2xhc3Moby5hY3RpdmVQYWdpbmF0aW9uQ2xhc3MpOw0KICAgICAgICAgICAgICAgIGlmICgkLmlzRnVuY3Rpb24oby5wYWdpbmF0aW9uRm4pKSB7DQogICAgICAgICAgICAgICAgICAgIG8ucGFnaW5hdGlvbkZuLmNhbGwob2xkQWN0aXZlLCAnaW5hY3RpdmUnKTsNCiAgICAgICAgICAgICAgICAgICAgby5wYWdpbmF0aW9uRm4uY2FsbChuZXdBY3RpdmUsICdhY3RpdmUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGdldE51bW1lcmljUG9zaXRpb246IGZ1bmN0aW9uKGVQb3Mpew0KICAgICAgICAgICAgdmFyIHJlbCA9IGZhbHNlLCBudW0sIGxhc3REaW0gPSB0aGlzLmRpbXNbdGhpcy5kaW1zLmxlbmd0aCAtIDFdOw0KICAgICAgDQogICAgICAgICAgICAvLyBoYW5kbGUgQXRvbSBTdGVwICYgZ29Ubw0KICAgICAgICAgICAgaWYgKGVQb3MuaW5kZXhPZignZ29UbycpID09PSAwKSB7DQogICAgICAgICAgICAgICAgbnVtID0gcGFyc2VJbnQoLyhcZCspJC8uZXhlYyhlUG9zKVswXSwgMTApICsgMjsNCiAgICAgICAgICAgICAgICBlUG9zID0gdGhpcy5kaW1zW251bV07DQogICAgICAgICAgICB9DQogICAgICBlbHNlIGlmIChlUG9zLmluZGV4T2YoJ2NlbnRlclRvJykgPT09IDApIHsNCiAgICAgICAgbnVtID0gcGFyc2VJbnQoLyhcZCspJC8uZXhlYyhlUG9zKVswXSwgMTApICsgMjsNCiAgICAgICAgZVBvcyA9IHRoaXMuZGltc1tudW1dIC0gKHRoaXMuZGltc1sxXSAvIDIpICsgKHRoaXMuYXRvbUVsZW0uZmlsdGVyKCI6ZXEoIitudW0rIikiKVt0aGlzLm9wdGlvbnMuZGlyZWN0aW9uLm91dGVyRF0oKSAvIDIpOw0KICAgICAgfQ0KICAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgICAgICBpZiAoZVBvcyA9PSAnLWF0b20nIHx8IGVQb3MgPT0gJy1hdG9tMScpIHsNCiAgICAgICAgICAgICAgICAgICAgbnVtID0gdGhpcy5hdG9tUG9zICsgMzsNCiAgICAgICAgICAgICAgICAgICAgZVBvcyA9ICh0aGlzLmRpbXNbbnVtXSB8fCB0aGlzLmRpbXNbbnVtXSA9PT0gMCkgPyB0aGlzLmRpbXNbbnVtXSA6IGxhc3REaW07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgDQogICAgICAgICAgICAgICAgICAgIGlmIChlUG9zID09ICcrYXRvbScgfHwgZVBvcyA9PSAnK2F0b20xJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgZVBvcyA9ICh0aGlzLmF0b21Qb3MpID8gdGhpcy5kaW1zW3RoaXMuYXRvbVBvcyArIDFdIDogMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVQb3MuaW5kZXhPZignYXRvbScpID09IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW0gPSBwYXJzZUludCgvKFxkKykkLy5leGVjKGVQb3MpWzBdLCAxMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVQb3MuaW5kZXhPZignLScpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bSArPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaW1zW3RoaXMuYXRvbVBvcyArIG51bV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVQb3MgPSB0aGlzLmRpbXNbdGhpcy5hdG9tUG9zICsgbnVtXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVQb3MgPSBsYXN0RGltOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW0gLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFMZW4gPSB0aGlzLmF0b21Qb3MgLSBudW07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhTGVuID4gMSAmJiB0aGlzLmRpbXNbdGhpcy5hdG9tUG9zIC0gbnVtXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVBvcyA9IHRoaXMuZGltc1t0aGlzLmF0b21Qb3MgLSBudW1dOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVBvcyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGU6ICsvLU51bWJlcg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZVBvcy5pbmRleE9mKCcrJykgPT09IDAgfHwgZVBvcy5pbmRleE9mKCctJykgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsID0gZVBvcy5zbGljZSgwLCAxKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVBvcyA9IHBhcnNlSW50KGVQb3Muc2xpY2UoMSksIDEwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVBvcyA9IChyZWwgPT0gJy0nKSA/IHRoaXMucG9zaXRpb24gKyBlUG9zIDogdGhpcy5wb3NpdGlvbiAtIGVQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgUGVyY2VudGFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVyID0gLyhcZCspJSQvLmV4ZWMoZVBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZXIgJiYgcGVyWzFdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlUG9zID0gdGhpcy5tYXhQb3MgLyAxMDAgKiBwYXJzZUZsb2F0KGVQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgaWYodGhpcy5vcHRpb25zLnN0aWNreUZpcnN0TGFzdCl7DQogICAgICAgIGlmKChlUG9zIC0gdGhpcy5tYXhQb3MpICogLTEgPCB0aGlzLmF0b21FbGVtLmZpbHRlcignOmxhc3QnKVt0aGlzLm9wdGlvbnMuZGlyZWN0aW9uLm91dGVyRF0oKSl7DQogICAgICAgICAgICAgICAgICAgIGlmIChlUG9zID4gdGhpcy5tYXhQb3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVQb3MgPSB0aGlzLm1heFBvczsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYoZVBvcyA8IHRoaXMuYXRvbUVsZW1bdGhpcy5vcHRpb25zLmRpcmVjdGlvbi5vdXRlckRdKCkpew0KICAgICAgICAgIGVQb3MgPSAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAgICAgICByZXR1cm4gZVBvczsNCiAgICAgICAgfSwNCiAgICAgICAgbW92ZVRvOiBmdW5jdGlvbihwb3MsIGFuaW0sIGFuaW1PcCl7DQogICAgICBwb3MgPSAodHlwZW9mIHBvcyA9PT0gJ3N0cmluZycgfHwgaXNOYU4ocG9zKSkgPyB0aGlzLmdldE51bW1lcmljUG9zaXRpb24ocG9zKSA6IHBvczsNCiAgICAgICAgcG9zID0gKHBvcyA8PSAwKSA/IDAgOiAocG9zID49IHRoaXMubWF4UG9zKSA/IHRoaXMubWF4UG9zIDogcG9zOw0KICAgICAgICAgICAgaWYgKHBvcyA9PT0gdGhpcy5wb3NpdGlvbikgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLCBzY3JvbGwgPSBvLmRpcmVjdGlvbi5zY3JvbGw7DQogICAgICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uX0NvbnRyb2xzKHBvcyk7DQogICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZSgnc3RhcnQnLCB0aGlzLm9sZFBvc2l0aW9uKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYW5pbSA9ICh0eXBlb2YgYW5pbSA9PSAndW5kZWZpbmVkJykgPyBvLmFuaW1hdGUgOiBhbmltOw0KICAgICAgICAgICAgaWYgKGFuaW0pIHsNCiAgICAgICAgICAgICAgICAvL2RpcnR5IGJyZWFrIHJlY3Vyc2lvbg0KICAgICAgICAgICAgICAgIGFuaW1PcCA9IGFuaW1PcCB8fA0KICAgICAgICAgICAgICAgIHt9Ow0KICAgICAgICAgICAgICAgIGFuaW1PcCA9ICQuZXh0ZW5kKHt9LCBvLmFuaW1hdGVPcHRpb25zLCB7DQogICAgICAgICAgICAgICAgICAgIHNsaWRlOiB0aGlzDQogICAgICAgICAgICAgICAgfSwgYW5pbU9wKTsNCiAgICAgICAgICAgICAgICB2YXIgYW5pbUNzcyA9IChzY3JvbGwgPT0gJ3Njcm9sbFRvcCcpID8gDQogICAgICAgICAge3Njcm9sbGVyVG9wOiBwb3N9IDogDQogICAgICAgICAge3Njcm9sbGVyTGVmdDogcG9zfQ0KICAgICAgICA7DQogICAgICAgICAgICAgICAgdGhpcy5oaWRpbmdXcmFwcGVyLnN0b3AoKS5hbmltYXRlKGFuaW1Dc3MsIGFuaW1PcCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmhpZGluZ1dyYXBwZXIuc3RvcCgpW3Njcm9sbF0ocG9zKTsNCiAgICAgICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZSgnZW5kJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHVpOiBmdW5jdGlvbigpew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBpbnN0YW5jZTogdGhpcywNCiAgICAgICAgICAgICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnMsDQogICAgICAgICAgICAgICAgcG9zOiB0aGlzLnBvc2l0aW9uLA0KICAgICAgICAgICAgICAgIHBlcmNlbnRQb3M6IHRoaXMucGVyY2VudGFnZSwNCiAgICAgICAgICAgICAgICBvbGRJbmRleDogdGhpcy5vbGRBdG9tUG9zLA0KICAgICAgICAgICAgICAgIG5ld0luZGV4OiB0aGlzLmF0b21Qb3MsDQogICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5kaW1zLmxlbmd0aCAtIDINCiAgICAgICAgICAgIH07DQogICAgICAgIH0sDQogICAgICAgIHByb3BhZ2F0ZTogZnVuY3Rpb24obiwgcG9zKXsNCiAgICAgIHZhciBhcmdzID0gKHBvcyB8fCBwb3MgPT09IDApID8gJC5leHRlbmQoe30sIHRoaXMudWkoKSwgew0KICAgICAgICAgICAgICAgICdwb3MnOiBwb3MsDQogICAgICAgICAgICAgICAgcGVyY2VudFBvczogcG9zIC8gKHRoaXMubWF4UG9zIC8gMTAwKQ0KICAgICAgICAgICAgfSkgOiB0aGlzLnVpKCk7DQogICAgICBpZihuID09PSAnc3RhcnQnKXsNCiAgICAgICAgdGhpcy5pc1NsaWRpbmcgPSB0cnVlOw0KICAgICAgfSBlbHNlIGlmKG4gPT09ICdlbmQnKXsNCiAgICAgICAgdGhpcy5pc1NsaWRpbmcgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VySGFuZGxlcigidWlzY3JvbGxlciIgKyBuLCBbYXJnc10pOw0KICAgICAgaWYodGhpcy5vcHRpb25zW25dKXsNCiAgICAgICAgdGhpcy5vcHRpb25zW25dLmNhbGwodGhpcy5lbGVtZW50WzBdLCB7dHlwZTogJ3Vpc2Nyb2xsZXInICsgbn0sIGFyZ3MpOw0KICAgICAgfQ0KICAgICAgICB9DQogIH0pOw0KICAkLmVhY2goe3Njcm9sbGVyTGVmdDogJ3Njcm9sbExlZnQnLCBzY3JvbGxlclRvcDogJ3Njcm9sbFRvcCd9LCBmdW5jdGlvbihuYW1lLCBwcm9wKXsNCiAgICAkLmZ4LnN0ZXBbbmFtZV0gPSBmdW5jdGlvbihmeCl7DQogICAgICAgICAgICBpZiAoZngubm93IHx8IGZ4Lm5vdyA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHZhciBzY3JvbGxlciA9IGZ4Lm9wdGlvbnMuc2xpZGU7DQogICAgICAgICAgICAgICAgaWYgKHNjcm9sbGVyKSB7DQogICAgICAgICAgaWYoIWZ4LnNjcm9sbGVySW5pdCl7DQogICAgICAgICAgICBmeC5zY3JvbGxlckluaXQgPSB0cnVlOw0KICAgICAgICAgICAgZnguc3RhcnQgPSBzY3JvbGxlci5oaWRpbmdXcmFwcGVyW3Byb3BdKCk7DQogICAgICAgICAgICBmeC5ub3cgPSBmeC5zdGFydDsNCiAgICAgICAgICB9DQogICAgICAgICAgc2Nyb2xsZXIuaGlkaW5nV3JhcHBlcltwcm9wXShmeC5ub3cpOw0KICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZXIucHJvcGFnYXRlKCdzbGlkZScsIGZ4Lm5vdyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICB9KTsNCiAgIA0KfSkoalF1ZXJ5KTsNCg==</sv:value>
  </sv:property>
  <sv:property sv:name="version" sv:type="String">
    <sv:value/>
  </sv:property>
  <sv:node sv:name="MetaData">
    <sv:property sv:name="jcr:primaryType" sv:type="Name">
      <sv:value>mgnl:metaData</sv:value>
    </sv:property>
    <sv:property sv:name="jcr:created" sv:type="Date">
      <sv:value>2013-07-22T14:26:52.298+02:00</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:activated" sv:type="Boolean">
      <sv:value>true</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:activatorid" sv:type="String">
      <sv:value>superuser</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:authorid" sv:type="String">
      <sv:value>amag</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:creationdate" sv:type="Date">
      <sv:value>2013-07-22T14:26:52.298+02:00</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:lastaction" sv:type="Date">
      <sv:value>2013-08-08T14:52:55.955+02:00</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:lastmodified" sv:type="Date">
      <sv:value>2013-08-12T16:07:15.060+02:00</sv:value>
    </sv:property>
    <sv:property sv:name="mgnl:template" sv:type="String">
      <sv:value>js</sv:value>
    </sv:property>
  </sv:node>
</sv:node>
